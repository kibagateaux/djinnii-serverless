Object.defineProperty(exports,"__esModule",{value:true});exports.getMovesStorylineData=undefined;var _moves2=require('moves');var _moves3=_interopRequireDefault(_moves2);var _awsSdk=require('aws-sdk');var _awsSdk2=_interopRequireDefault(_awsSdk);var _movesData=require('../../lib/movesData');function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}_awsSdk2.default.config.update({region:"us-east-1"});var dynamoDb=new _awsSdk2.default.DynamoDB.DocumentClient();var movesAuthInitUrl='https://api.moves-app.com/oauth/v1/authorize?response_type=code&client_id='+MOVES_API_KEY+'&scope=activity+location';var getMovesStorylineData=exports.getMovesStorylineData=function getMovesStorylineData(event,context){var userId=event.pathParameters.userId;var queryParams={table:process.env.DYNAMODB_TOKENS_TABLE,Key:{userId:userId}};dynamoDb.getItem(params,function(error,results){if(error){console.log('moves storyline fetch user tokens failed',error);}else if(results.moves){var _results$moves=results.moves,access_token=_results$moves.access_token,refresh_token=_results$moves.refresh_token;var _moves=new Moves({client_id:process.env.MOVES_API_KEY,access_token:access_token,refresh_token:refresh_token});_moves.get('/user/storyline/daily?pastDays=7&trackPoints=true').then(function(response){var norms=(0,_movesData.normalizeStorylineData)(response.data);var newActivities=(0,_movesData.createActivitiesList)(norms);console.log('get moves store',norms,newActivities);}).catch(function(error){console.log('moves storyline fetch data failed',error);});}else{console.log('get moves tokens null',results);}});};