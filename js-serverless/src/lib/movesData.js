Object.defineProperty(exports,"__esModule",{value:true});exports.normalizeStorylineData=exports.createActivitiesList=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};var _time=require('./time');function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}var normalizeMovesAPILocation=function normalizeMovesAPILocation(place){return place?_extends({id:place.id},place.location,{type:place.type}):null;};var normalizeMovesAPITrackingPoints=function normalizeMovesAPITrackingPoints(activity){return activity.trackPoints?activity.trackPoints.reduce(function(points,_ref){var time=_ref.time,lat=_ref.lat,lon=_ref.lon;console.log('norm track pnt',points);var trackTime=(0,_time._formatToUnix)(time);return _extends({},points,_defineProperty({},trackTime,{lat:lat,lon:lon}));},{}):null;};var normalizeActivities=function normalizeActivities(seg){return seg.activities?seg.activities.map(function(act){var actTimes=(0,_time._getTimesInUnix)(act.startTime,act.endTime);segTimes=(0,_time._getTimesInUnix)(seg.startTime,seg.endTime);var normAct=_extends({},act,actTimes,{trackPoints:normalizeMovesAPITrackingPoints(act),activityGroup:_extends({},segTimes,{type:seg.type,place:normalizeMovesAPILocation(seg.place)})});return normAct;}):[];};var addFillerSpace=function addFillerSpace(activityList){var completeList={};var activityTimes=Object.keys(activityList);activityTimes.reduce(function(last,next){var endTime=activityList[last.time].endTime;var startTime=activityList[next].startTime;var place=activityList[next].activityGroup.place||last.place;endTime!==startTime+1?completeList[endTime+1]={startTime:endTime+1,endTime:startTime-1,duration:startTime-endTime,activity:'idl',place:place,activityGroup:{type:'filler',startTime:endTime+1,endTime:startTime-1}}:null;return{time:next,place:place};},{time:activityTimes[0],place:{}});return completeList;};var createActivitiesList=exports.createActivitiesList=function createActivitiesList(stories){var activityList={};stories.map(function(day){day.activityGroups.map(function(acts){acts.map(function(act){if(act.startTime)activityList[act.startTime]=act;});});});var fillerActs=addFillerSpace(activityList);var organizedCompleteList=(0,_time._sortByTime)(_extends({},fillerActs,activityList));return organizedCompleteList;};var normalizeStorylineData=exports.normalizeStorylineData=function normalizeStorylineData(stories){return stories.map(function(day){var date=day.date,lastUpdate=day.lastUpdate,calories=day.calories,summary=day.summary;var normSeg=day.segments.map(function(seg){return normalizeActivities(seg);}).filter(function(seg){return seg.length>0;});var unixDate=(0,_time._getFirstMSInDay)((0,_time._formatToUnix)(date));var unixLastUpdate=(0,_time._formatToUnix)(lastUpdate);return{date:date,lastUpdate:lastUpdate,summary:_extends({},summary,{calories:calories}),activityGroups:normSeg};});};